<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>abofhd515</title>
    <style>
        @media print {
            body > *:not(.print-only) {
                display: none !important;
            }
            body {
                background-color: white;
                color: black;
                padding: 0;
                margin: 0;
            }
            .print-only {
                display: block !important;
                width: 100%;
                max-width: none;
                margin: 0;
                padding: 20px;
            }
            .print-header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
            }
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                page-break-inside: avoid;
            }
            .print-table th, .print-table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: right;
            }
            .print-table th {
                background-color: #f0f0f0;
            }
            .print-summary {
                margin-top: 20px;
                padding: 10px;
                border: 1px solid #000;
                page-break-inside: avoid;
            }
            .print-summary p {
                margin: 5px 0;
                font-size: 16px;
            }
            .section-title {
                font-size: 18px;
                font-weight: bold;
                margin: 20px 0 10px 0;
                text-align: right;
                border-bottom: 1px solid #000;
                padding-bottom: 5px;
            }
        }
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            padding: 20px;
        }
        input, select, textarea, button {
            background-color: #1e1e1e;
            color: #fff;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 5px;
            margin: 5px;
        }
        table {
            width: 100%;
            max-width: 600px;
            margin: auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
        }
        .Ø­Ø§Ø¶Ø± { background-color: #003300; }
        .ØºØ§Ø¦Ø¨ { background-color: #330000; }
        .ÙØ±Ù‚ { background-color: #002244; }
        .Ø§Ù†Ø³Ø­Ø§Ø¨ { background-color: #333333; }
        .print-btn {
            background-color: #007bff;
            color: white;
            border: none;
        }
        .print-only {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ’¼ abofhd515</h1>

    <textarea id="namesInput" placeholder="Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŒ Ø§Ø³Ù… ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±" rows="6" style="width:90%; max-width:500px;"></textarea><br>
    <button onclick="generateNames()">ğŸ—Œ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>

    <div id="namesTable"></div>
    <div id="nameSummary" style="margin-top: 10px; font-size: 18px;"></div><br><div id="summaryTable" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;"></div>

    <input type="text" id="date" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ§Ø±ÙŠØ®">
    <select id="period">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</option>
        <option value="ØµØ¨Ø§Ø­ÙŠ">ØµØ¨Ø§Ø­ÙŠ</option>
        <option value="Ù…Ø³Ø§Ø¦ÙŠ">Ù…Ø³Ø§Ø¦ÙŠ</option>
    </select><br>

    <input type="number" id="ghayr_nazel" placeholder="ØºÙŠØ± Ø§Ù„Ù†Ø§Ø²Ù„ (Ù…Ø³Ø¨Ù‚)">
    <input type="number" id="ghiyab" placeholder="Ø§Ù„ØºÙŠØ§Ø¨" readonly>
    <input type="number" id="withdrawal" placeholder="Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨" readonly><br>

    <button onclick="calculate()">âœ¨ Ø§Ø­Ø³Ø¨</button>
    <button onclick="resetData()">ğŸ—‘ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    <button onclick="window.print()" class="print-btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>

    <div class="result" id="results"></div>
    <div class="success-message" id="fr-message"></div>

    <div id="print-content" class="print-only">
        <div class="print-header">
            <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h2>
            <p id="print-date"></p>
            <p id="print-period"></p>
        </div>
        
        <div id="print-ghiyab"></div>
        <div id="print-fareq"></div>
        <div id="print-withdrawal"></div>
        
        <div id="print-results" class="print-summary"></div>
    </div>

    <script>
        function generateNames() {
            localStorage.setItem('namesInput', document.getElementById('namesInput').value);
            const rawNames = document.getElementById('namesInput').value.trim().split('\n');
            let html = '<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
            rawNames.forEach((name, index) => {
                if (name.trim()) {
                    html += `<tr class="row">
                        <td>${index + 1}- ${name.trim()}</td>
                        <td>
                            <select class="status-select" onchange="syncCounts(); saveState();">
                                <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
                                <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨</option>
                                <option value="ÙØ±Ù‚">ÙØ±Ù‚</option>
                                <option value="Ø§Ù†Ø³Ø­Ø§Ø¨">Ø§Ù†Ø³Ø­Ø§Ø¨</option>
                            </select>
                        </td>
                        <td><input type='text' class='fareq-note' oninput="saveState();" placeholder='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©'></td>
                    </tr>`;
                }
            });
            html += '</table>';
            document.getElementById('namesTable').innerHTML = html;
            syncCounts();
        }

        function syncCounts() {
            const selects = document.querySelectorAll('.status-select');
            let hadir = 0, ghiyab = 0, fareq = 0, withdrawal = 0;
            selects.forEach(sel => {
                const val = sel.value;
                const row = sel.closest('tr');
                row.className = val;
                if (val === "Ø­Ø§Ø¶Ø±") hadir++;
                else if (val === "ØºØ§Ø¦Ø¨") ghiyab++;
                else if (val === "ÙØ±Ù‚") fareq++;
                else if (val === "Ø§Ù†Ø³Ø­Ø§Ø¨") withdrawal++;
            });
            document.getElementById("nameSummary").innerText =
                `Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†: ${hadir} | Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨: ${ghiyab} | Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚: ${fareq} | Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨: ${withdrawal}`;
            document.getElementById("ghiyab").value = ghiyab;
            document.getElementById("withdrawal").value = withdrawal;
        }

        function saveState() {
            localStorage.setItem('namesInput', document.getElementById('namesInput').value);
            const statuses = Array.from(document.querySelectorAll('.status-select')).map(s => s.value);
            const notes = Array.from(document.querySelectorAll('.fareq-note')).map(n => n.value);
            localStorage.setItem('statuses', JSON.stringify(statuses));
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        function calculate() {
            localStorage.setItem('ghayr_nazel', document.getElementById('ghayr_nazel').value);
            localStorage.setItem('date', document.getElementById('date').value);
            localStorage.setItem('period', document.getElementById('period').value);
            const rows = Array.from(document.querySelectorAll('#namesTable table tr')).slice(1);
            rows.sort((a, b) => {
                const order = ['ØºØ§Ø¦Ø¨', 'Ø§Ù†Ø³Ø­Ø§Ø¨', 'ÙØ±Ù‚', 'Ø­Ø§Ø¶Ø±'];
                const aVal = a.children[1].querySelector('select').value;
                const bVal = b.children[1].querySelector('select').value;
                return order.indexOf(aVal) - order.indexOf(bVal);
            });
            const table = document.querySelector('#namesTable table');
            rows.forEach((r, i) => {
                const nameCell = r.children[0];
                const originalName = nameCell.textContent.split('- ')[1];
                nameCell.textContent = `${i + 1}- ${originalName}`;
                table.appendChild(r);
            });

            let hadir = 0, fareq = 0, ghiyab = 0, withdrawal = 0;
            const selects = document.querySelectorAll('.status-select');
            selects.forEach(sel => {
                if (sel.value === "Ø­Ø§Ø¶Ø±") hadir++;
                else if (sel.value === "ÙØ±Ù‚") fareq++;
                else if (sel.value === "ØºØ§Ø¦Ø¨") ghiyab++;
                else if (sel.value === "Ø§Ù†Ø³Ø­Ø§Ø¨") withdrawal++;
            });

            const totalNames = selects.length;
            const nazel = totalNames - ghiyab - withdrawal;
            const nazelAfterGhiyab = nazel;
            const ghayrNazel = parseInt(document.getElementById('ghayr_nazel').value) || 0;
            const ghayrNazelAfter = ghayrNazel + ghiyab + withdrawal;
            const alFi3ly = nazel - fareq;
            const alMalak = nazel + ghayrNazelAfter;

            const dateText = document.getElementById('date').value || '-';
            const periodText = document.getElementById('period').value || '-';
            const summaryTable = document.getElementById("summaryTable");
            const filteredRows = rows.filter(row => {
                const status = row.children[1].querySelector('select').value;
                return status !== 'Ø­Ø§Ø¶Ø±';
            });
            let summaryHTML = '<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
            filteredRows.forEach(r => {
                const name = r.children[0].innerText;
                const status = r.children[1].querySelector('select').value;
                const task = r.children[2].querySelector('input').value;
                summaryHTML += `<tr><td>${name}</td><td>${status}</td><td>${task}</td></tr>`;
            });
            summaryHTML += '</table>';
            summaryTable.innerHTML = summaryHTML;

            document.getElementById("results").innerHTML = `
                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateText} <br>
                Ø§Ù„ÙØªØ±Ø©: ${periodText} <br><br>
                Ø§Ù„ÙØ±Ù‚ Ø§Ù„ÙƒÙ„ÙŠ: ${fareq}<br>
                Ø§Ù„Ù†Ø§Ø²Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØºÙŠØ§Ø¨: ${nazelAfterGhiyab}<br>
                ØºÙŠØ± Ø§Ù„Ù†Ø§Ø²Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØºÙŠØ§Ø¨: ${ghayrNazelAfter}<br>
                Ø§Ù„ÙØ¹Ù„ÙŠ: ${alFi3ly}<br>
                Ø§Ù„Ù…Ù„Ø§Ùƒ: ${alMalak}`;

            document.getElementById("fr-message").innerText = nazelAfterGhiyab > 0 ? "ÙØ±Ø±Ø±Ø±Ø±Ø±" : "";

            // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            document.getElementById('print-date').textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateText}`;
            document.getElementById('print-period').textContent = `Ø§Ù„ÙØªØ±Ø©: ${periodText}`;

            // ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
            const ghiyabRows = filteredRows.filter(r => r.children[1].querySelector('select').value === 'ØºØ§Ø¦Ø¨');
            const fareqRows = filteredRows.filter(r => r.children[1].querySelector('select').value === 'ÙØ±Ù‚');
            const withdrawalRows = filteredRows.filter(r => r.children[1].querySelector('select').value === 'Ø§Ù†Ø³Ø­Ø§Ø¨');

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØºÙŠØ§Ø¨
            let ghiyabHTML = '<div class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºÙŠØ§Ø¨</div>';
            if (ghiyabRows.length > 0) {
                ghiyabHTML += '<table class="print-table"><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
                ghiyabRows.forEach(r => {
                    const name = r.children[0].innerText;
                    const task = r.children[2].querySelector('input').value;
                    ghiyabHTML += `<tr><td>${name}</td><td>${task}</td></tr>`;
                });
                ghiyabHTML += '</table>';
            } else {
                ghiyabHTML += '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨</p>';
            }
            document.getElementById('print-ghiyab').innerHTML = ghiyabHTML;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ±Ù‚
            let fareqHTML = '<div class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ù‚</div>';
            if (fareqRows.length > 0) {
                fareqHTML += '<table class="print-table"><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
                fareqRows.forEach(r => {
                    const name = r.children[0].innerText;
                    const task = r.children[2].querySelector('input').value;
                    fareqHTML += `<tr><td>${name}</td><td>${task}</td></tr>`;
                });
                fareqHTML += '</table>';
            } else {
                fareqHTML += '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚</p>';
            }
            document.getElementById('print-fareq').innerHTML = fareqHTML;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨
            let withdrawalHTML = '<div class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨</div>';
            if (withdrawalRows.length > 0) {
                withdrawalHTML += '<table class="print-table"><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
                withdrawalRows.forEach(r => {
                    const name = r.children[0].innerText;
                    const task = r.children[2].querySelector('input').value;
                    withdrawalHTML += `<tr><td>${name}</td><td>${task}</td></tr>`;
                });
                withdrawalHTML += '</table>';
            } else {
                withdrawalHTML += '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù†Ø³Ø­Ø§Ø¨</p>';
            }
            document.getElementById('print-withdrawal').innerHTML = withdrawalHTML;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            document.getElementById('print-results').innerHTML = `
                <p>Ø§Ù„ÙØ±Ù‚ Ø§Ù„ÙƒÙ„ÙŠ: ${fareq}</p>
                <p>Ø§Ù„Ù†Ø§Ø²Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØºÙŠØ§Ø¨: ${nazelAfterGhiyab}</p>
                <p>ØºÙŠØ± Ø§Ù„Ù†Ø§Ø²Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØºÙŠØ§Ø¨: ${ghayrNazelAfter}</p>
                <p>Ø§Ù„ÙØ¹Ù„ÙŠ: ${alFi3ly}</p>
                <p>Ø§Ù„Ù…Ù„Ø§Ùƒ: ${alMalak}</p>`;
        }

        function resetData() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§.")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = function () {
            const namesInput = localStorage.getItem('namesInput');
            const statuses = JSON.parse(localStorage.getItem('statuses') || '[]');
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            if (namesInput) {
                document.getElementById('namesInput').value = namesInput;
                generateNames();
                const selects = document.querySelectorAll('.status-select');
                const inputs = document.querySelectorAll('.fareq-note');
                selects.forEach((s, i) => s.value = statuses[i] || "Ø­Ø§Ø¶Ø±");
                inputs.forEach((n, i) => n.value = notes[i] || "");
                syncCounts();
            }
            document.getElementById('ghayr_nazel').value = localStorage.getItem('ghayr_nazel') || "";
            document.getElementById('date').value = localStorage.getItem('date') || "";
            document.getElementById('period').value = localStorage.getItem('period') || "";
        }
    </script>
</body>
</html> 